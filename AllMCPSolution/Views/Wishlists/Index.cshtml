@model AllMCPSolution.Controllers.WishlistsController.WishlistsViewModel
@using AllMCPSolution.Controllers
@using AllMCPSolution.Models
@{
    Layout = null;
    var currentPath = Context?.Request?.Path.Value ?? string.Empty;
    var topBarModel = ViewData["WineSurferTopBarModel"] as WineSurferTopBarModel
        ?? WineSurferTopBarModel.Empty(currentPath);

    var inventoryAddModalModel = ViewData["InventoryAddModal"] as InventoryAddModalViewModel
        ?? new InventoryAddModalViewModel();

    var wishlistHeaderTemplate = new CrudTableHeaderTemplateModel
    {
        ActionLabel = "Add wine",
        ActionCssClass = "wine-surfer-button wishlist-add-trigger",
        ActionAttributes = new Dictionary<string, string?>
        {
            ["data-wishlist-add-trigger"] = string.Empty
        }
    };

    var table = new CrudTableTemplateModel
    {
        Title = string.IsNullOrWhiteSpace(Model.SelectedWishlistName) ? "Wishlist" : Model.SelectedWishlistName,
        DataTableKey = "wishlist-wines",
        HeaderTemplate = wishlistHeaderTemplate,
        BodyContent = @<text>
            <table class="crud-table__table">
                <thead>
                    <tr class="crud-table__header-row">
                        <th class="summary-header summary-header--wine"><span class="header-text">Wine</span></th>
                        <th class="summary-header summary-header--appellation"><span class="header-text">Appellation</span></th>
                        <th class="summary-header summary-header--vintage"><span class="header-text">Vintage</span></th>
                        <th class="summary-header summary-header--actions"><span class="sr-only">Actions</span></th>
                    </tr>
                </thead>
                <tbody>
                @if (Model.Items is { Count: > 0 })
                {
                    foreach (var item in Model.Items)
                    {
                        var addButtonLabel = "add";
                        var addButtonAriaLabel = $"Add {item.WineName} to your inventory";
                        var buyUrl = string.IsNullOrWhiteSpace(item.WineSearcherUrl)
                            ? "https://www.wine-searcher.com/"
                            : item.WineSearcherUrl;
                        <tr class="crud-table__row">
                            <td class="summary-cell summary-cell--wine">
                                <a class="link" href="/wine/@item.WineId">@item.WineName</a>
                            </td>
                            <td class="summary-cell summary-cell--appellation">
                                <span class="appellation">@item.Appellation</span>
                                @if (!string.IsNullOrWhiteSpace(item.Region))
                                {
                                    <span class="region"> (@item.Region)</span>
                                }
                            </td>
                            <td class="summary-cell summary-cell--vintage">@item.Vintage</td>
                            <td class="summary-cell summary-cell--actions">
                                <div class="wishlist-actions">
                                    <button type="button"
                                            class="sisterhood-button wishlist-actions__button"
                                            data-wishlist-add-button
                                            data-wine-id="@item.WineId"
                                            data-wine-name="@item.WineName"
                                            data-wine-country="@item.Country"
                                            data-wine-region="@item.Region"
                                            data-wine-appellation="@item.Appellation"
                                            data-wine-sub-appellation="@item.SubAppellation"
                                            data-wine-color="@item.Color"
                                            data-wine-variety="@item.Variety"
                                            data-wine-vintage="@item.Vintage"
                                            aria-label="@addButtonAriaLabel">
                                        @addButtonLabel
                                    </button>
                                    <a class="sisterhood-button wishlist-actions__button"
                                       href="@buyUrl"
                                       target="_blank"
                                       rel="noopener noreferrer"
                                       aria-label="Buy @item.WineName on Wine-Searcher">
                                        buy
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="4" class="empty-state">No wines in this wishlist yet.</td>
                    </tr>
                }
                </tbody>
            </table>
            <p class="wishlist-actions-message" data-wishlist-message hidden role="status"></p>
        </text>
    };
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wishlists â€¢ Wine Surfer</title>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#050505" />
    <link rel="stylesheet" href="/css/wine-surfer-theme.css" />
    <link rel="stylesheet" href="/css/wine-surfer-shadcn.css" />
    <link rel="stylesheet" href="/css/wine-surfer-shared-ui.css" />
    <script defer src="/js/pwa.js"></script>
    <style>
        :root { color-scheme: dark; }
        body { margin: 0; background: var(--wine-app-background); color: hsl(var(--foreground)); }
        .wine-surfer-layout--wishlists { gap: 32px; }
        .wine-surfer-layout--wishlists > * { width: min(960px, 100%); }
        .wishlists-content { display: flex; flex-direction: column; gap: 24px; align-items: stretch; }
        .wishlists-content .crud-table { width: 100%; }
        .wishlist-select-group { width: 100%; padding: 20px; display: flex; flex-wrap: wrap; gap: 12px; align-items: center; border-radius: 18px; background: var(--wine-surface-gradient); border: 1px solid var(--wine-surface-border); }
        .wishlist-select-group label { font-size: 0.95rem; letter-spacing: 0.04em; text-transform: uppercase; color: hsla(var(--muted-foreground) / 0.85); }
        .wishlist-select-group select { padding: 10px 14px; border-radius: 12px; background: var(--wine-surface); color: hsl(var(--foreground)); border: 1px solid var(--wine-surface-border); min-width: min(280px, 100%); flex: 1 1 220px; }
        .wishlist-select-group button { flex: 0 0 auto; }
        .summary-cell--actions { width: 220px; }
        .wishlist-actions { display: flex; justify-content: flex-end; flex-wrap: wrap; gap: 8px; }
        .wishlist-actions__button { padding: 10px 16px; min-width: 0; }
        .wishlist-actions-message { margin: 12px 0 0; font-size: 0.875rem; color: hsla(var(--muted-foreground) / 0.9); }
        .wishlist-actions-message[hidden] { display: none; }
        .wishlist-actions-message[data-state="success"] { color: hsla(var(--ring) / 0.85); }
        .wishlist-actions-message[data-state="error"] { color: hsla(var(--destructive) / 0.9); }
        @@media (max-width: 768px) {
            .wine-surfer-layout--wishlists { gap: 24px; }
            .wishlist-select-group { padding: 16px; }
        }
    </style>
</head>
<body class="wine-app wine-app--with-bottom-nav">
    @await Html.PartialAsync("_WineSurferTopBar", topBarModel)

    <main class="wine-surfer-layout wine-surfer-layout--wishlists">
        <section class="wishlists-content">
            <div class="wishlist-select-group">
                <label for="wishlistSelect">Wishlist</label>
                <select id="wishlistSelect" onchange="if (this.value) { window.location = '/wine-surfer/wishlists?wishlistId=' + this.value; }">
                    @if (Model.Wishlists is { Count: > 0 })
                    {
                        foreach (var wl in Model.Wishlists)
                        {
                            var isSelected = Model.SelectedWishlistId.HasValue && wl.Id == Model.SelectedWishlistId.Value;
                            <option value="@wl.Id" selected="@(isSelected ? "selected" : null)">@wl.Name (@wl.WishCount)</option>
                        }
                    }
                    else
                    {
                        <option value="">No wishlists yet</option>
                    }
                </select>
                <button type="button" class="wine-surfer-button wine-surfer-button--orange" id="createWishlistBtn">Create wishlist</button>
                @if (Model.SelectedWishlistId.HasValue)
                {
                    <button type="button" class="wine-surfer-button" id="renameWishlistBtn">Edit name</button>
                    <button type="button" class="wine-surfer-button wine-surfer-button--red" id="deleteWishlistBtn">Delete</button>
                }
            </div>

            @await Html.PartialAsync("_CrudTableTemplate", table)
        </section>
    </main>

    @await Html.PartialAsync("_InventoryAddModal", inventoryAddModalModel)
    @await Html.PartialAsync("_WishlistPopover")

    @{ var createModal = new WineSurferModalShell
       {
           BackdropId = "create-wishlist-overlay",
           BackdropCssClass = "wine-surfer-modal-backdrop",
           BackdropAttributes = new Dictionary<string, string?> { ["hidden"] = null, ["aria-hidden"] = "true" },
           DialogId = "create-wishlist-modal",
           DialogCssClass = "wine-surfer-modal",
           DialogAttributes = new Dictionary<string, string?> { ["aria-labelledby"] = "create-wishlist-title" },
           Title = "Create wishlist",
           TitleElementId = "create-wishlist-title",
           BodyContent = @<form id="create-wishlist-form" class="inventory-add-form" novalidate>
               <label class="inventory-add-field">
                   <span class="inventory-add-label">Name</span>
                   <input type="text" id="create-wishlist-name" maxlength="256" placeholder="e.g. Summer Sippers" aria-label="Wishlist name" required />
               </label>
               <p class="inventory-add-error" id="create-wishlist-error" role="alert" aria-hidden="true"></p>
               <div class="inventory-add-actions">
                   <button type="button" class="crud-table__action-button secondary" data-close-create>Cancel</button>
                   <button type="submit" class="crud-table__action-button">Create</button>
               </div>
           </form>
       }; }
    @await Html.PartialAsync("_WineSurferModalShell", createModal)

    @{ var renameModal = new WineSurferModalShell
       {
           BackdropId = "rename-wishlist-overlay",
           BackdropCssClass = "wine-surfer-modal-backdrop",
           BackdropAttributes = new Dictionary<string, string?> { ["hidden"] = null, ["aria-hidden"] = "true" },
           DialogId = "rename-wishlist-modal",
           DialogCssClass = "wine-surfer-modal",
           DialogAttributes = new Dictionary<string, string?> { ["aria-labelledby"] = "rename-wishlist-title" },
           Title = "Rename wishlist",
           TitleElementId = "rename-wishlist-title",
           BodyContent = @<form id="rename-wishlist-form" class="inventory-add-form" novalidate>
               <label class="inventory-add-field">
                   <span class="inventory-add-label">New name</span>
                   <input type="text" id="rename-wishlist-name" maxlength="256" placeholder="e.g. Summer Sippers" aria-label="New wishlist name" required />
               </label>
               <p class="inventory-add-error" id="rename-wishlist-error" role="alert" aria-hidden="true"></p>
               <div class="inventory-add-actions">
                   <button type="button" class="crud-table__action-button secondary" data-close-rename>Cancel</button>
                   <button type="submit" class="crud-table__action-button">Save</button>
               </div>
           </form>
       }; }
    @await Html.PartialAsync("_WineSurferModalShell", renameModal)

    <script defer src="/js/inventory-add-modal.js"></script>
    <script defer src="/js/wishlists.js"></script>
    @await Html.PartialAsync("_WineSurferBottomNav", Context?.Request?.Path.Value)
</body>
</html>
