@model AllMCPSolution.Models.BottleManagementModalViewModel?
@using System
@using System.Collections.Generic
@{ 
    var options = Model ?? BottleManagementModalViewModel.Default;

    var overlayId = string.IsNullOrWhiteSpace(options.OverlayId)
        ? BottleManagementModalViewModel.Default.OverlayId
        : options.OverlayId;
    var dialogId = string.IsNullOrWhiteSpace(options.DialogId)
        ? BottleManagementModalViewModel.Default.DialogId
        : options.DialogId;
    var bodyCssClass = string.IsNullOrWhiteSpace(options.BodyCssClass)
        ? BottleManagementModalViewModel.Default.BodyCssClass
        : options.BodyCssClass;
    var titleElementId = string.IsNullOrWhiteSpace(options.TitleElementId)
        ? BottleManagementModalViewModel.Default.TitleElementId
        : options.TitleElementId;
    var closeButtonAriaLabel = string.IsNullOrWhiteSpace(options.CloseButtonAriaLabel)
        ? BottleManagementModalViewModel.Default.CloseButtonAriaLabel
        : options.CloseButtonAriaLabel;

    var overlayAttributes = options.OverlayAttributes is null
        ? new Dictionary<string, string?>(StringComparer.OrdinalIgnoreCase)
        : new Dictionary<string, string?>(options.OverlayAttributes, StringComparer.OrdinalIgnoreCase);
    if (!overlayAttributes.ContainsKey("hidden"))
    {
        overlayAttributes["hidden"] = null;
    }
    overlayAttributes["aria-hidden"] = "true";
    overlayAttributes["data-bottle-management-overlay"] = "true";

    var dialogAttributes = options.DialogAttributes is null
        ? new Dictionary<string, string?>(StringComparer.OrdinalIgnoreCase)
        : new Dictionary<string, string?>(options.DialogAttributes, StringComparer.OrdinalIgnoreCase);
    dialogAttributes["aria-labelledby"] = titleElementId;
    dialogAttributes["data-bottle-management-modal"] = "true";

    var drinkingWindowStartId = $"{dialogId}-drinking-window-start";
    var drinkingWindowEndId = $"{dialogId}-drinking-window-end";

    var bodyAttributes = options.BodyAttributes is null
        ? new Dictionary<string, string?>(StringComparer.OrdinalIgnoreCase)
        : new Dictionary<string, string?>(options.BodyAttributes, StringComparer.OrdinalIgnoreCase);
    bodyAttributes["data-bottle-management-body"] = "true";

    var closeAttributes = new Dictionary<string, string?>(StringComparer.OrdinalIgnoreCase)
    {
        ["data-bottle-management-close"] = null
    };

    var modal = new WineSurferModalShell
    {
        BackdropId = overlayId,
        BackdropCssClass = string.IsNullOrWhiteSpace(options.OverlayCssClass)
            ? BottleManagementModalViewModel.Default.OverlayCssClass
            : options.OverlayCssClass,
        BackdropAttributes = overlayAttributes,
        DialogId = dialogId,
        DialogCssClass = string.IsNullOrWhiteSpace(options.DialogCssClass)
            ? BottleManagementModalViewModel.Default.DialogCssClass
            : options.DialogCssClass,
        DialogAttributes = dialogAttributes,
        HeaderCssClass = "wine-surfer-modal__header bottle-management-modal__header",
        Title = "Manage bottles",
        TitleCssClass = "wine-surfer-modal__title bottle-management-modal__title",
        TitleElementId = titleElementId,
        BodyCssClass = bodyCssClass,
        BodyAttributes = bodyAttributes,
        CloseButtonCssClass = "wine-surfer-modal__close bottle-management-modal__close",
        CloseButtonLabel = closeButtonAriaLabel,
        CloseButtonAttributes = closeAttributes,
        BodyContent = @<section class="bottle-management" data-bottle-management-root>
            <input type="hidden" value="" data-bottle-management-vintage-id />
            <header class="bottle-management-summary" aria-live="polite">
                <h3 class="bottle-management-wine">
                    <span data-bottle-management-wine>Choose a wine</span> <span data-bottle-management-vintage class="bottle-management-vintage">- —</span>
                </h3>
                <p class="bottle-management-meta">
                    <span data-bottle-management-average>Avg. score: —</span>
                    <span class="bottle-management-meta-separator" aria-hidden="true" hidden>&bull;</span>
                    <span class="bottle-management-drinking-window" data-bottle-management-drinking-window>
                        <span class="bottle-management-drinking-window-display" data-bottle-management-drinking-window-display>Drinking window: —</span>
                        <label class="sr-only" for="@drinkingWindowStartId">Drinking window start year</label>
                        <input type="number"
                               id="@drinkingWindowStartId"
                               class="bottle-management-drinking-window-input"
                               inputmode="numeric"
                               min="1900"
                               max="2200"
                               step="1"
                               data-bottle-management-drinking-window-start
                               disabled />
                        <label class="sr-only" for="@drinkingWindowEndId">Drinking window end year</label>
                        <input type="number"
                               id="@drinkingWindowEndId"
                               class="bottle-management-drinking-window-input"
                               inputmode="numeric"
                               min="1900"
                               max="2200"
                               step="1"
                               data-bottle-management-drinking-window-end
                               disabled />
                        <button type="button"
                                class="wine-surfer-button wine-surfer-button--orange bottle-management-save-window-button"
                                data-bottle-management-save-drinking-window
                                disabled>
                            Save drinking window
                        </button>
                    </span>
                </p>
            </header>
            <p class="bottle-management-error" data-bottle-management-error aria-live="assertive" hidden></p>
            @if (options.HeaderContent is not null)
            {
                @options.HeaderContent(null)
            }
            <section class="bottle-management-table-section">
                <header class="bottle-management-table-header">
                    <div class="bottle-management-actions">
                        <label class="bottle-management-control">
                            <span class="bottle-management-control-label">Location</span>
                            <select class="bottle-management-select" data-bottle-management-location disabled>
                                <option value="">No location</option>
                            </select>
                        </label>
                        <label class="bottle-management-control">
                            <span class="bottle-management-control-label">Quantity</span>
                            <select class="bottle-management-select" data-bottle-management-quantity>
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                        </label>
                        <button type="button" class="wine-surfer-button wine-surfer-button--orange bottle-management-add-button" data-bottle-management-add disabled>
                            Add Bottles
                        </button>
                    </div>
                </header>
                <div class="bottle-management-table-container">
                    <table class="crud-table__table bottle-management-table" data-bottle-management-table>
                        <caption class="sr-only">Bottles for the selected wine vintage</caption>
                        <thead>
                            <tr class="crud-table__header-row">
                                <th scope="col" class="bottle-management-col-location">Location</th>
                                <th scope="col" class="bottle-management-col-price">Price</th>
                                <th scope="col" class="bottle-management-col-score">Score</th>
                                <th scope="col" class="bottle-management-col-status">Enjoyed</th>
                                <th scope="col" class="bottle-management-col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody data-bottle-management-rows>
                            <tr class="empty-row"><td colspan="5">Select a wine to view your bottles.</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </section>
    };
}

@await Html.PartialAsync("_WineSurferModalShell", modal)
<script src="/js/bottle-management-modal.js" defer></script>
